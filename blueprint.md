# FilePortal蓝图
本项目是一个文件上传的JS SDK，初版功能主要包括
* 音频上传
* 流量控制
* 大文件分块上传
* 暂停与取消上传
* 多文件上传

## API设计

1. 构造函数
我个人认为sdk需要进行实例化，理由有几个，一个是实例化sdk可以让一个应用具有多个不同配置的实例，对于一些应用场景应该是很必要的。
```Javascript
const client = new FilePortal({})
```
关于配置我暂时想到如下配置
* debug 主要用于开启console或者其他的调试效果？
* chunkSize 分块大小
* accept 过滤文件类型，mimetype


2. （重置）上传凭证设置方法
由于凭证可能在过程中过期，需要对外提供一个方法供上传凭证token的更新。

3. 事件监听机制
提供上传过程中的事件机制。（要附带源头，比如取消一个上传，说明源头是系统本身还是用户自己调API取消的）。同时需要能够跟踪一个具体的任务（在多文件上传中尤为重要，比如progress）
事件暂时想到如下
* 上传任务进入队列（多文件上传）
* 上传任务开始（真正开始传输）
* 上传任务暂停
* 上传任务取消
* 上传任务进度变更
* 上传任务成功
* 上传任务失败并开始重传（暂时不加重传）
* 上传任务失败并重传次数达到上线（暂时不加重传）


4. 流量控制
设置uploader整体上传的流量控制。

5. 多文件上传管理
这部分要求做到当前正在上传的并发数的控制，同时上传完成后自动开始下一个上传


6. 上传，核心部分，用于文件上传到服务器
这部分由于需要多文件上传
```Typescript
client.addTask = ({
    token: () => Promise<string> | string, // 支持放一个返回promise的函数或者单纯的string，设置上传凭证
    file: File,
    extra: {}, // 扩展用
    config: {}  // 文件特定的设置？
}) => {}

client.start = (tid) => {}
client.pause = (tid) => {}
client.resume = (tid) => {}
client.cancel = (tid) => {}

client.list = () => {} // 获取全部任务
```